name: Deploy Pandoc

on:
  - push

jobs:
  deploy:
     runs-on: ubuntu-latest
     steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
          submodules: 'recursive'
      - name: Install Go
        if: success()
        uses: actions/setup-go@v2
        with:
          go-version: 1.17.x
      - name: Install goplantuml
        run: |
          go install github.com/jfeliu007/goplantuml/cmd/goplantuml@v1.5.2
      - run: mkdir out
      - name: Create UML data
        run: goplantuml -recursive src > out/uml.puml
      - name: Generate UML PNG
        uses: cloudbees/plantuml-github-action@master
        with:
          args: -v -tpng out/uml.puml
      - name: Build PDF
        uses: docker://pandoc/latex:2.11
        with:
          args: -d pandoc/pandoc -t pdf -o out/doc.pdf
      - name: Upload artifact
        uses: actions/upload-artifact@v2
        with:
          name: doc.pdf
          path: |
            out/doc.pdf
            out/*.png
          if-no-files-found: error
